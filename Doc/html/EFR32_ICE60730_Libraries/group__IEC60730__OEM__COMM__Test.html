<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IEC_60730: OEM External Communications Example using UART</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IEC_60730
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">OEM External Communications Example using UART<div class="ingroups"><a class="el" href="group__efr32__iec60730.html">EFR32 IEC60730 Library</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Verifies communication channel is operating as expected.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for OEM External Communications Example using UART:</div>
<div class="dyncontent">
<div class="center"><img src="group__IEC60730__OEM__COMM__Test.png" border="0" usemap="#group____IEC60730____OEM____COMM____Test" alt=""/></div>
</div>
<p>Verifies communication channel is operating as expected. </p>
<h1><a class="anchor" id="communications_hardware_architecture"></a>
Hardware Architecture</h1>
<p>For communications interfaces to be IEC compliant, they must meet the following conditions:</p><ol type="1">
<li>Provide address redundancy, transmitting the sender's unique address</li>
<li>CRC coverage of transmission bytes</li>
<li>Scheduled transmission</li>
</ol>
<p>Each type of hardware-implemented serial interface supported by a device must meet the three above communications requirements using a combination of hardware features and firmware-implemented support.</p>
<p>For I2C interfaces, the protocol requires that a transaction begin with a slave address identifying the intended recipient of the message, which meets requirement 1. Each message transferred must end with a 2-byte CRC covering all transmitted bytes. Hardware CRC generation is available on some devices and a buffer of bytes can generate a CRC using the <a class="el" href="group__IEC60730__INVARIABLE__MEMORY__Test.html#gabdc62d310b78ec8e9f011cb28c6b9225">iec60730_updateCRCWithDataBuffer</a> provided, which meets requirement #2. Requirement #3 can be met by initiating a periodic transaction using the test timer allocated for the system clock plausibility check.</p>
<p>A SPI interface meets the requirements above in a way that is similar to the I2C interface, except that an address must be included through firmware, because the protocol and the hardware do not support a slave address inherently.</p>
<p>A UART interface meets requirements similar to a SPI interface, where the address must be transmitted through firmware implemented protocol.</p>
<h1><a class="anchor" id="communications_failure_risks"></a>
Failure Risks</h1>
<p>A disruption of the serial interface signals/clocks could cause a bit error or a timing-related issue. This will result in a CRC mismatch when the receiver of the message processes the packet, and safe state entrance.</p>
<p>If the device sending status packets to a host gets somehow stuck in such a state where it is unable to transmit status packets, the receiver expecting periodic packets will enter safe state after a bounded amount of time, likely governed by a bist frequency check that determines no status packets have been received within a frequency check interval. Based on suggested configuration of the bist frequency check period, the upper limit for time between reception of a status packet would be 1 second. Based on suggested configuration of the test timer, typically the status packet will be transmitted once every 100 ms.</p>
<p>All serial interfaces require some amount of port configuration to ensure that correct pins are digital inputs and outputs, open drain or push-pull. Without these requirements being met, the device will be unable to transmit and receive data packets properly, which will result in a safe state entrance by one or both of the devices communicating across a serial interface.</p>
<h1><a class="anchor" id="communications_software_architecture"></a>
Software Architecture</h1>
<p>The library provides a support function <a class="el" href="group__IEC60730__INVARIABLE__MEMORY__Test.html#gabdc62d310b78ec8e9f011cb28c6b9225">iec60730_updateCRCWithDataBuffer()</a> to generate the CRC of a buffer being transmitted. OEM firmware is responsible for interfacing with serial communication hardware to send packets that begin with address information to identify the sender and end with a 2-byte CRC.</p>
<p>In order to transmit a status packet, the device needs to allocate an on-chip timer, or use the test timer already allocated for the system clock plausibility check.</p>
<p>Devices receiving status packets rely on a bist frequency check where one requirement for the comm plausibility test to have executed successfully is the reception of a valid status packet.</p>
<p><a class="el" href="group__IEC60730__OEM__COMM__Test.html#comm_plausibility_check">Figure 1</a> shows the main components of both a receiver and a transmitter of a compliant serial interface. Note that received packages are processed by checking for an address and a valid CRC. Additionally, a bist frequency check determines whether status packets are being received at an acceptable rate. For transmission, all data payloads go through firmware that adds required address and CRC information. Additionally, the test timer interrupt service routine initiates a periodic transmission of a status packet.</p>
<div class="image">
<img src="comm_plausibility_check.png" alt=""/>
<div class="caption">
Figure 1 comm plausibility check flowchart</div></div>
<p><a class="anchor" id="comm_plausibility_check"></a></p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
