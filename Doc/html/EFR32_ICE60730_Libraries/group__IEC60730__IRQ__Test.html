<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IEC_60730: IRQ Test</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IEC_60730
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">IRQ Test<div class="ingroups"><a class="el" href="group__efr32__iec60730.html">EFR32 IEC60730 Library</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Verifies interrupt frequency is within bounds.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for IRQ Test:</div>
<div class="dyncontent">
<div class="center"><img src="group__IEC60730__IRQ__Test.png" border="0" usemap="#group____IEC60730____IRQ____Test" alt=""/></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structiec60730__IRQExecutionBounds__t.html">iec60730_IRQExecutionBounds_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga1fd484f2e669b4da687d4aa4f3d2a079"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__IEC60730__IRQ__Test.html#ga1fd484f2e669b4da687d4aa4f3d2a079">SI_SEGMENT_VARIABLE</a> (iec60730_IRQExecCount[], uint8_t, SI_SEG_DATA)</td></tr>
<tr class="separator:ga1fd484f2e669b4da687d4aa4f3d2a079"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac7cfeb8778147ca004c51acfeb58d26f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__IEC60730__IRQ__Test.html#gac7cfeb8778147ca004c51acfeb58d26f">SI_SEGMENT_CONST</a> (iec60730_IRQFreqBounds[], <a class="el" href="structiec60730__IRQExecutionBounds__t.html">iec60730_IRQExecutionBounds_t</a>, SI_SEG_CODE)</td></tr>
<tr class="separator:gac7cfeb8778147ca004c51acfeb58d26f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacf8f01fda2cf8af6c68b16362fcbe78e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__IEC60730__IRQ__Test.html#gacf8f01fda2cf8af6c68b16362fcbe78e">SI_SEGMENT_CONST</a> (iec60730_IRQFreqBoundsSize, uint8_t, SI_SEG_CODE)</td></tr>
<tr class="separator:gacf8f01fda2cf8af6c68b16362fcbe78e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga12a2f3b916aba015300180051a01c1fd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__IEC60730__IRQ__Test.html#ga12a2f3b916aba015300180051a01c1fd">iec60730_IRQCheck</a> (void)</td></tr>
<tr class="separator:ga12a2f3b916aba015300180051a01c1fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Verifies interrupt frequency is within bounds. </p>
<p>The interrupt plausibility test checks that enabled interrupts are executing at a frequency that is within expected minimum and maximum bounds every test timer period.</p>
<p>OEM firmware is responsible for setting expected minimum and maximum bounds for each enabled interrupt in the #iec60730_IRQFreqBounds structure. The OEM is also responsible for incrementing the element in the #iec60730_IRQExecCount array inside each enabled interrupt. In <a class="el" href="group__IEC60730__IRQ__Test.html#ga12a2f3b916aba015300180051a01c1fd">iec60730_IRQCheck()</a>, which executes as part of the test timer-driven tests of the BIST, this counter array is compared with the defined bounds to determine whether each interrupt is operating within safe parameters.</p>
<h1><a class="anchor" id="irq_hardware_architecture"></a>
Hardware Architecture</h1>
<p>Most hardware-implemented peripherals in Silicon Labs EFR32 devices offer the ability to vector to an interrupt service routine in order to quickly respond peripheral-related events and state updates.</p>
<p>In order to vector to an interrupt from executing foreground code, hardware pushes the program counter to the stack and vectors to a hardware-defined entry in a vector table stored in non-volatile memory in a region of Flash. The code of the interrupt service routine is either stored directly within this table entry, or stored elsewhere in memory and accessed through a jump instruction placed in the vector table, depending on the size of the interrupt service routine.</p>
<p>Once the function body of the interrupt service routine has completed executing, the program counter is pop from the stack and returns to foreground code to continue execution.</p>
<p>Each interrupt has a flag in a register that must be cleared inside the interrupt service routine function to signal that the interrupt has been processed in firmware. Failure to clear this flag inside the function body will result in the hardware immediately vectoring back to the interrupt.</p>
<h1><a class="anchor" id="irq_failure_risks"></a>
Failure Risks</h1>
<p>It is the OEM's responsibility to accurately estimate the frequency of each enabled interrupt in a firmware project. For interrupts that are asynchronous and may not execute at all within a test timer period, the lower bounds for the interrupt should be set to 0.</p>
<p>It is also the OEM's responsibility to increment values in #iec60730_IRQExecCount once and only once per interrupt execution. Failure to include this incrementing command will result in an interrupt that appears to be executing below minimum defined bounds, which will force safe state entry.</p>
<p>The OEM should also be mindful of all hardware-related constraints of each interrupt. Failure to clear an interrupt flag inside an interrupt service routine will cause the routine to execute repeatedly, which will increment an #iec60730_IRQExecCount entry beyond upper bounds and cause a safe state entry.</p>
<p>The OEM must also perform a bounds check on the element in #iec60730_IRQExecCount being incremented to ensure that the counter does not exceed the upper bounds defined by its data type and overflow back to 0. Failure to perform this bounds check could have the effect of creating a passing IRQ plausibility test when the interrupt is actually running outside of defined limits.</p>
<h1><a class="anchor" id="irq_software_architecture"></a>
Software Architecture</h1>
<p>The interrupt plausibility test function relies on an array of counters called #iec60730_IRQExecCount, stored in volatile memory and an array of struct <a class="el" href="structiec60730__IRQExecutionBounds__t.html">iec60730_IRQExecutionBounds_t</a> found in non-volatile memory and called #iec60730_IRQFreqBounds. OEM firmware increments bytes in #iec60730_IRQExecCount during execution of each enabled interrupt service routine. When the test timer interrupt occurs, <a class="el" href="group__IEC60730__IRQ__Test.html#ga12a2f3b916aba015300180051a01c1fd">iec60730_IRQCheck()</a> executes. Inside this function, firmware compares the count values to the bound values, and sets #iec60730_SafetyCheck to <a class="el" href="group__IEC60730__POST.html#ggab423b676af8982b70e767164f1574023ad57c493440d16f911ef6c0fdfe03db3d" title="Interrupt Plausibility Check detected a failure.">iec60730_InterruptFail</a> if a count exceeds either the minimum or maximum bounds. The next execution of the BIST routine will detect the <a class="el" href="group__IEC60730__POST.html#gga15a78a582ee2ef5999615f3a64d26741a26db973cd4fdebd964685ce701486450" title="test result failed">iec60730_TestFailed</a> state and enter safe state. A flowchart of this functionality is shown in <a class="el" href="group__IEC60730__IRQ__Test.html#irq_plausibility_test_flowchart">Figure 1</a>.</p>
<p>For more information on configuration of the test timer, please see <a class="el" href="group__IEC60730__SYSTEM__CLOCK__Test.html">System clock plausibility test</a>.</p>
<p><a class="anchor" id="irq_plausibility_test_flowchart"></a>\ </p><div class="image">
<img src="irq_plausibility_test_flowchart.png" alt=""/>
<div class="caption">
Figure 1 Flow chart of interrupt plausibility check</div></div>
 <h2 class="groupheader">Function Documentation</h2>
<a id="ga12a2f3b916aba015300180051a01c1fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga12a2f3b916aba015300180051a01c1fd">&#9670;&nbsp;</a></span>iec60730_IRQCheck()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void iec60730_IRQCheck </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>public IEC60730 Interrupt plausibility check</p>
<dl class="section return"><dt>Returns</dt><dd>None.</dd></dl>
<p>This function compares each entry in #iec60730_IRQExecCount with its corresponding bounds defined in #iec60730_IRQFreqBounds. If the entry is found to exceed the defined bounds, #iec60730_SafetyCheck is set to <a class="el" href="group__IEC60730__POST.html#ggab423b676af8982b70e767164f1574023ad57c493440d16f911ef6c0fdfe03db3d" title="Interrupt Plausibility Check detected a failure.">iec60730_InterruptFail</a>. Otherwise no action is taken. The function ends by setting <a class="el" href="group__IEC60730__PROGRAMME__COUNTER.html#ga33e80e609861bd9b4907bcc349154d2e" title="Mask bit used for Interrupt Checks completed.">IEC60730_INTERRUPT_COMPLETE</a> in #iec60730_programmeCounterCheck. </p>

</div>
</div>
<a id="gac7cfeb8778147ca004c51acfeb58d26f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac7cfeb8778147ca004c51acfeb58d26f">&#9670;&nbsp;</a></span>SI_SEGMENT_CONST() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SI_SEGMENT_CONST </td>
          <td>(</td>
          <td class="paramtype">iec60730_IRQFreqBounds&#160;</td>
          <td class="paramname">[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structiec60730__IRQExecutionBounds__t.html">iec60730_IRQExecutionBounds_t</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SI_SEG_CODE&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Defines expected interrupt min/max boundaries for plausibility testing</p>
<p>This OEM-defined structure defines the expected minimum and maximum number of executions for every test clock period. The interrupt plausibility test, which executes at the end of a test clock period, compares the number of ISR executions for each ISR as defined in the #iec60730_IRQExecCount array. A count outside the defined bounds results in a safe state entry. </p>

</div>
</div>
<a id="gacf8f01fda2cf8af6c68b16362fcbe78e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gacf8f01fda2cf8af6c68b16362fcbe78e">&#9670;&nbsp;</a></span>SI_SEGMENT_CONST() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SI_SEGMENT_CONST </td>
          <td>(</td>
          <td class="paramtype">iec60730_IRQFreqBoundsSize&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SI_SEG_CODE&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Defines number of interrupt entries in #iec60730_IRQFreqBounds</p>
<p>This count is used by the test to step through each entry in #iec60730_IRQFreqBounds to determine if the count for each interrupt exceeds expected min/max bounds. </p>

</div>
</div>
<a id="ga1fd484f2e669b4da687d4aa4f3d2a079"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1fd484f2e669b4da687d4aa4f3d2a079">&#9670;&nbsp;</a></span>SI_SEGMENT_VARIABLE()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SI_SEGMENT_VARIABLE </td>
          <td>(</td>
          <td class="paramtype">iec60730_IRQExecCount&#160;</td>
          <td class="paramname">[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SI_SEG_DATA&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Defines number of interrupt entries in #iec60730_IRQFreqBounds</p>
<p>This count is used by the test to step through each entry in #iec60730_IRQFreqBounds to determine if the count for each interrupt exceeds expected min/max bounds. OEM code is responsible for incrementing the element of this array corresponding to the IRQ described by the corresponding element in #iec60730_IRQFreqBounds. The incrementing instruction should only be placed inside the IRQ referred to by the element. The element will be reset to 0 by the interrupt plausibility check executing in <a class="el" href="group__IEC60730__SYSTEM__CLOCK__Test.html#ga6b15a364dd6ec51c0246903d2e678fca">iec60730_TestClockTick</a>. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
