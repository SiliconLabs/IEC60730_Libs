<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IEC60730 Library: CPU Registers Check</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IEC60730 Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">CPU Registers Check<div class="ingroups"><a class="el" href="group__efr32__iec60730.html">EFR32 IEC60730 Library</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Verifies CPU registers are working correctly.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gad44643a21eb76be8f92a850c9a67ee19"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__sl__iec60730__post.html#gabbc6d6c18b9b696bfe4eb327f28fb47e">sl_iec60730_test_result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__IEC60730__CPU__REG__TEST.html#gad44643a21eb76be8f92a850c9a67ee19">sl_iec60730_cpu_registers_bist_ns</a> (void)</td></tr>
<tr class="separator:gad44643a21eb76be8f92a850c9a67ee19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga835e9328723d7a4fa8de5b3fc991ea58"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__sl__iec60730__post.html#gabbc6d6c18b9b696bfe4eb327f28fb47e">sl_iec60730_test_result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__IEC60730__CPU__REG__TEST.html#ga835e9328723d7a4fa8de5b3fc991ea58">sl_iec60730_cpu_registers_bist_s</a> (void)</td></tr>
<tr class="separator:ga835e9328723d7a4fa8de5b3fc991ea58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1b948a92b96d88eb0247735b44f37a60"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__sl__iec60730__post.html#gabbc6d6c18b9b696bfe4eb327f28fb47e">sl_iec60730_test_result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__IEC60730__CPU__REG__TEST.html#ga1b948a92b96d88eb0247735b44f37a60">sl_iec60730_cpu_registers_bist</a> (void)</td></tr>
<tr class="separator:ga1b948a92b96d88eb0247735b44f37a60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga83e19aa1d360edac8fdba6e49369c397"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__sl__iec60730__post.html#gabbc6d6c18b9b696bfe4eb327f28fb47e">sl_iec60730_test_result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__IEC60730__CPU__REG__TEST.html#ga83e19aa1d360edac8fdba6e49369c397">sl_iec60730_cpu_registers_post</a> (void)</td></tr>
<tr class="separator:ga83e19aa1d360edac8fdba6e49369c397"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Verifies CPU registers are working correctly. </p>
<h1><a class="anchor" id="cpureg_hardware_architecture"></a>
Hardware Architecture</h1>
<p>The CM33 CPU registers include the following registers:</p>
<p>General-purpose registers: • R0-R12</p>
<p>Stack pointer registers: • MSP + MSPLIM (secure/non-secure) • PSP + PSPLIM (secure/non-secure)</p>
<p>Special registers: • APSR • CONTROL (secure/non-secure) • PRIMASK (secure/non-secure) • FAULTMASK (secure/non-secure) • BASEPRI (secure/non-secure)</p>
<p>Link register: • LR</p>
<p>FPU registers: • FPSCR • S0 – S31</p>
<p>There is a set of tests performed once after the MCU reset and also during runtime.</p>
<h1><a class="anchor" id="cpureg_failure_risks"></a>
Failure Risks</h1>
<p>The primary risks with the CPU registers are stuck bits and shorted bits. The CPU register tests will verify that bits can be set high and low, and adjacent bits are not shorted.</p>
<h1><a class="anchor" id="cpureg_software_architecture"></a>
Software Architecture</h1>
<p>Because internal CPU registers are being tested, the code must be written using assembly language.</p>
<p>The identification of safety errors is ensured by the specific FAIL return if some registers have the stuck-at fault. Assess the return value of every function. If the value equals the FAIL return, then a jump into the safety error handling function should occur. The safety error handling function may be specific to the application and it is not a part of the library. The main purpose of this function is to put the application into a safe state.</p>
<p>In some special cases, the error is not reported by the FAIL return, because it would require the action of a corrupt register. In that case, the function waits for reset in an endless loop. The principle of the stuck-at error test of the CPU registers is to write and compare two test patterns in every register. The content of the register is compared with the constant or with the value written into another register that was tested before. Most of the time, R0, R1, and R2 are used as auxiliary registers. Patterns are defined to check the logical one and logical zero values in all register bits.</p>
<p>Due to the Arm TrustZone support, some core registers are banked between the security states. The Secure (S) or Non-Secure (NS) sets of the corresponding registers are accessible during execution (depending on the current security state). Both register versions are accessible during the S state, but not during the NS state. This is the reason why the NXP Safety Library must be executed in a secure mode. All of the banked registers are listed above.</p>
<p>For the EFR32 IEC60730 implementation, <a class="el" href="group__IEC60730__CPU__REG__TEST.html#cpu_registers_check_flowchart">Figure 1</a> shows the logic flow chart of the CPU registers check during BIST and POST.</p>
<div class="image">
<img src="cpu_registers_check_flowchart.png" alt=""/>
<div class="caption">
Figure 1 CPU registers check flowchart</div></div>
<p><a class="anchor" id="cpu_registers_check_flowchart"></a></p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga1b948a92b96d88eb0247735b44f37a60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1b948a92b96d88eb0247735b44f37a60">&#9670;&nbsp;</a></span>sl_iec60730_cpu_registers_bist()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__sl__iec60730__post.html#gabbc6d6c18b9b696bfe4eb327f28fb47e">sl_iec60730_test_result_t</a> sl_iec60730_cpu_registers_bist </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>public IEC60730 CPU Registers Built In Self Test</p>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__sl__iec60730__post.html#gabbc6d6c18b9b696bfe4eb327f28fb47e" title="The result of a test.">sl_iec60730_test_result_t</a> </dd>
<dd>
<a class="el" href="group__sl__iec60730__post.html#ggabbc6d6c18b9b696bfe4eb327f28fb47eab4d54f4580fca45fad4926139fb63a22" title="test result failed">SL_IEC60730_TEST_FAILED</a> means test failed, <a class="el" href="group__sl__iec60730__post.html#ggabbc6d6c18b9b696bfe4eb327f28fb47ea61682a1e69b9b0cbdecbe0d11d14945e" title="test result passed">SL_IEC60730_TEST_PASSED</a> means test passed.</dd></dl>
<p>This function will do a test of all the CPU core registers in non-secure and secure state. </p>

</div>
</div>
<a id="gad44643a21eb76be8f92a850c9a67ee19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad44643a21eb76be8f92a850c9a67ee19">&#9670;&nbsp;</a></span>sl_iec60730_cpu_registers_bist_ns()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__sl__iec60730__post.html#gabbc6d6c18b9b696bfe4eb327f28fb47e">sl_iec60730_test_result_t</a> sl_iec60730_cpu_registers_bist_ns </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>public IEC60730 CPU Registers Built In Self Test</p>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__sl__iec60730__post.html#gabbc6d6c18b9b696bfe4eb327f28fb47e" title="The result of a test.">sl_iec60730_test_result_t</a> </dd>
<dd>
<a class="el" href="group__sl__iec60730__post.html#ggabbc6d6c18b9b696bfe4eb327f28fb47eab4d54f4580fca45fad4926139fb63a22" title="test result failed">SL_IEC60730_TEST_FAILED</a> means test failed, <a class="el" href="group__sl__iec60730__post.html#ggabbc6d6c18b9b696bfe4eb327f28fb47ea61682a1e69b9b0cbdecbe0d11d14945e" title="test result passed">SL_IEC60730_TEST_PASSED</a> means test passed.</dd></dl>
<p>This function will do a test of all the CPU core registers in non-secure state </p>

</div>
</div>
<a id="ga835e9328723d7a4fa8de5b3fc991ea58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga835e9328723d7a4fa8de5b3fc991ea58">&#9670;&nbsp;</a></span>sl_iec60730_cpu_registers_bist_s()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__sl__iec60730__post.html#gabbc6d6c18b9b696bfe4eb327f28fb47e">sl_iec60730_test_result_t</a> sl_iec60730_cpu_registers_bist_s </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>public IEC60730 CPU Registers Built In Self Test</p>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__sl__iec60730__post.html#gabbc6d6c18b9b696bfe4eb327f28fb47e" title="The result of a test.">sl_iec60730_test_result_t</a> </dd>
<dd>
<a class="el" href="group__sl__iec60730__post.html#ggabbc6d6c18b9b696bfe4eb327f28fb47eab4d54f4580fca45fad4926139fb63a22" title="test result failed">SL_IEC60730_TEST_FAILED</a> means test failed, <a class="el" href="group__sl__iec60730__post.html#ggabbc6d6c18b9b696bfe4eb327f28fb47ea61682a1e69b9b0cbdecbe0d11d14945e" title="test result passed">SL_IEC60730_TEST_PASSED</a> means test passed.</dd></dl>
<p>This function will do a test of all the CPU core registers in secure state </p>

</div>
</div>
<a id="ga83e19aa1d360edac8fdba6e49369c397"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga83e19aa1d360edac8fdba6e49369c397">&#9670;&nbsp;</a></span>sl_iec60730_cpu_registers_post()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__sl__iec60730__post.html#gabbc6d6c18b9b696bfe4eb327f28fb47e">sl_iec60730_test_result_t</a> sl_iec60730_cpu_registers_post </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>public IEC60730 CPU Registers Power On Self Test</p>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__sl__iec60730__post.html#gabbc6d6c18b9b696bfe4eb327f28fb47e" title="The result of a test.">sl_iec60730_test_result_t</a></dd></dl>
<p>This function simply calls the <a class="el" href="group__IEC60730__CPU__REG__TEST.html#ga1b948a92b96d88eb0247735b44f37a60">sl_iec60730_cpu_registers_bist()</a> function. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
